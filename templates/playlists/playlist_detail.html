{% extends "base.html" %}

{% block title %}
    {% if playlist %}
        Editar Lista: {{ playlist.title }}
    {% else %}
        Nueva Lista de Reproducción
    {% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/playlist_detail.css">
<style>
/* Estilos específicos para playlist detail */
.truncate-text {
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
}

.cursor-pointer {
    cursor: pointer;
}

.user-select-none {
    user-select: none;
}
</style>
{% endblock %}

{% block content %}
<!-- Datos de playlist para JavaScript -->
{% if playlist %}
<script type="application/json" id="playlist-data">
{
    "id": {{ playlist.id }},
    "title": "{{ playlist.title | safe }}",
    "description": "{{ playlist.description | safe if playlist.description else '' }}",
    "creation_date": "{{ playlist.creation_date.isoformat() if playlist.creation_date else '' }}",
    "updated_at": "{{ playlist.updated_at.isoformat() if playlist.updated_at else '' }}",
    "start_date": "{{ playlist.start_date.isoformat() if playlist.start_date else '' }}",
    "expiration_date": "{{ playlist.expiration_date.isoformat() if playlist.expiration_date else '' }}",
    "is_active": {{ playlist.is_active | lower }},
    "videos": [
        {% for pv in playlist.playlist_videos %}
        {
            "id": {{ pv.video.id }},
            "title": "{{ pv.video.title | safe }}",
            "description": "{{ pv.video.description | safe if pv.video.description else '' }}",
            "file_path": "{{ pv.video.file_path | safe }}",
            "duration": {{ pv.video.duration or 0 }},
            "position": {{ pv.position or 0 }},
            "order": {{ pv.position or 0 }}
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
<input type="hidden" id="playlist-id" value="{{ playlist.id }}">
{% endif %}

<!-- HEADER DE LA PÁGINA -->
<div class="page-header">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="page-title">
                <i class="fas fa-list-alt me-3"></i>
                {% if playlist %}
                        {{ playlist.title }}
                    {% else %}
                        Nueva Lista de Reproducción
                    {% endif %}
                </h1>
                <p class="page-subtitle mb-0">
                    {% if playlist %}
                        Edita y gestiona tu lista de reproducción
                    {% else %}
                        Crea y organiza tus listas de reproducción
                    {% endif %}
                </p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <div class="d-flex gap-2 justify-content-lg-end justify-content-center">
                    <button type="button" class="btn btn-primary" id="toggleEditModeBtn">
                        <i class="fas fa-edit me-2"></i>Modo Edición
                    </button>
                    <button type="button" class="btn btn-success" id="savePlaylistBtn" disabled>
                        <i class="fas fa-save me-2"></i>Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CONTENIDO PRINCIPAL -->
<div class="container-fluid">
    <!-- Tarjetas de estadísticas -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-value" id="statVideoCount">
                    {% if playlist %}
                        {{ playlist.playlist_videos|length }}
                    {% else %}
                        0
                    {% endif %}
                </div>
                <div class="stat-label">Videos</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-value" id="statTotalDuration">
                    {% if playlist %}
                        {% set total_duration = 0 %}
                        {% for pv in playlist.playlist_videos %}
                            {% set total_duration = total_duration + (pv.video.duration or 0) %}
                        {% endfor %}
                        
                        {% if total_duration > 3600 %}
                            {{ (total_duration // 3600) }}h {{ ((total_duration % 3600) // 60) }}m
                        {% else %}
                            {{ (total_duration // 60) }}m {{ (total_duration % 60) }}s
                        {% endif %}
                    {% else %}
                        0m 0s
                    {% endif %}
                </div>
                <div class="stat-label">Duración Total</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-value">
                    {% if playlist and playlist.is_active %}
                        <span class="text-success">Activa</span>
                    {% else %}
                        <span class="text-danger">Inactiva</span>
                    {% endif %}
                </div>
                <div class="stat-label">Estado</div>
            </div>
        </div>
    </div>
    
    <!-- Botones de acción -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="action-buttons d-flex flex-wrap gap-2 justify-content-center justify-content-md-start">
                <button type="button" class="btn btn-primary btn-action" onclick="window.location.href='/ui/playlists'">
                    <i class="fas fa-arrow-left"></i> Volver a Listas
                </button>
                
                {% if playlist %}
                <button type="button" class="btn btn-info btn-action" onclick="exportPlaylist({{ playlist.id }})">
                    <i class="fas fa-download"></i> Exportar
                </button>
                
                <button type="button" class="btn btn-warning btn-action" onclick="shufflePlaylist()">
                    <i class="fas fa-random"></i> Aleatorizar
                </button>
                
                <button type="button" class="btn btn-success btn-action" onclick="previewFullPlaylist()">
                    <i class="fas fa-play"></i> Previsualizar
                </button>
                
                <button type="button" class="btn btn-danger btn-action edit-action" style="display: none;" 
                        onclick="confirmDeletePlaylist({{ playlist.id }})">
                    <i class="fas fa-trash-alt"></i> Eliminar
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Contenido principal en pestañas -->
    <div class="row">
        <div class="col-md-6">
            <!-- Panel de detalles de playlist -->
            <div class="main-panel mb-4">
                <div class="panel-header bg-primary text-white p-3">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Detalles de la Lista</h5>
                </div>
                <div class="panel-body p-3">
                    <div id="playlistDetailsLoading" style="display: none;">
                        <div class="d-flex justify-content-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                        </div>
                    </div>
                    
                    <form id="playlistForm">
                        <div class="mb-3">
                            <label for="playlist_title" class="form-label">Título *</label>
                            <input type="text" class="form-control playlist-form-control" id="playlist_title" 
                                   value="{{ playlist.title if playlist else '' }}" required disabled
                                   oninput="markAsUnsaved()">
                        </div>
                        
                        <div class="mb-3">
                            <label for="playlist_description" class="form-label">Descripción</label>
                            <textarea class="form-control playlist-form-control" id="playlist_description" 
                                      rows="3" disabled oninput="markAsUnsaved()">{{ playlist.description if playlist and playlist.description else '' }}</textarea>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input playlist-form-control" id="playlist_is_active" 
                                   {% if playlist and playlist.is_active %}checked{% endif %} disabled
                                   onchange="markAsUnsaved()">
                            <label class="form-check-label" for="playlist_is_active">Lista activa</label>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="playlist_start_date" class="form-label">Fecha de inicio</label>
                                    <input type="date" class="form-control playlist-form-control" id="playlist_start_date" 
                                           value="{{ playlist.start_date.strftime('%Y-%m-%d') if playlist and playlist.start_date else '' }}" 
                                           disabled onchange="markAsUnsaved()">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="playlist_expiration_date" class="form-label">Fecha de expiración</label>
                                    <input type="date" class="form-control playlist-form-control" id="playlist_expiration_date" 
                                           value="{{ playlist.expiration_date.strftime('%Y-%m-%d') if playlist and playlist.expiration_date else '' }}" 
                                           disabled onchange="markAsUnsaved()">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Panel de videos en la playlist -->
            <div class="main-panel mb-4">
                <div class="panel-header bg-success text-white p-3">
                    <h5 class="mb-0"><i class="fas fa-film me-2"></i>Videos en la Lista</h5>
                </div>
                <div class="panel-body p-3">
                    <div id="playlistVideosLoading" style="display: none;">
                        <div class="d-flex justify-content-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="playlistVideosList">
                        {% if playlist and playlist.playlist_videos %}
                            {% for pv in playlist.playlist_videos|sort(attribute='position') %}
                            <div class="playlist-video-item" data-video-id="{{ pv.video.id }}" data-position="{{ pv.position or loop.index0 }}">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        <div class="video-handle">
                                            <i class="fas fa-grip-vertical text-muted"></i>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <span class="video-position">{{ loop.index }}</span>
                                    </div>
                                    <div class="col">
                                        <h6 class="mb-1">{{ pv.video.title }}</h6>
                                        <small class="text-muted">{{ ((pv.video.duration or 0) // 60)|int }}:{{ "%02d"|format(((pv.video.duration or 0) % 60)|int) }}</small>
                                    </div>
                                    <div class="col-auto">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    onclick="previewVideo({{ pv.video.id }})" title="Vista previa">
                                                <i class="fas fa-play"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-danger edit-action" 
                                                    style="display: none;"
                                                    onclick="removeVideoFromPlaylist({{ pv.video.id }})" title="Quitar de la lista">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                Esta lista de reproducción no tiene videos. Agrega videos desde la biblioteca.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <!-- Panel de biblioteca de videos -->
            <div class="main-panel mb-4">
                <div class="panel-header bg-info text-white p-3">
                    <h5 class="mb-0"><i class="fas fa-photo-video me-2"></i>Biblioteca de Videos</h5>
                </div>
                <div class="panel-body p-3">
                    <!-- Buscador de videos -->
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" id="videoSearchInput" 
                                   placeholder="Buscar videos por título...">
                            <button class="btn btn-primary edit-action" type="button" id="addVideoToPlaylistBtn" style="display: none;">
                                <i class="fas fa-plus me-2"></i>Agregar Seleccionados
                            </button>
                        </div>
                    </div>
                    
                    <div id="availableVideosLoading" style="display: none;">
                        <div class="d-flex justify-content-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="availableVideosList">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Cargando videos disponibles...
                        </div>
                    </div>
                </div>
            </div>
            <!-- Panel de dispositivos asignados -->
            <div class="main-panel mb-4">
                <div class="panel-header bg-warning text-white p-3">
                    <h5 class="mb-0"><i class="fas fa-tablet-alt me-2"></i>Dispositivos Asignados</h5>
                </div>
                <div class="panel-body p-3">
                    <div id="assignedDevicesList">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Cargando dispositivos asignados...
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-outline-primary edit-action" style="display: none;"
                                onclick="openAssignDevicesModal()">
                            <i class="fas fa-plus me-2"></i>Asignar a Dispositivos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de previsualización -->
<div class="modal fade" id="videoPreviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Vista Previa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body text-center">
                <div class="video-preview-container">
                    <video id="previewVideoPlayer" class="w-100" controls>
                        <source src="" type="video/mp4">
                        Tu navegador no soporta la reproducción de videos.
                    </video>
                </div>
                <div class="mt-3">
                    <h6 id="previewVideoTitle"></h6>
                    <p id="previewVideoDescription" class="text-muted"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para confirmar eliminación -->
<div class="modal fade" id="deletePlaylistModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>Eliminar Lista
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que deseas eliminar esta lista de reproducción?</p>
                <p><strong>Esta acción no se puede deshacer.</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirmDeletePlaylistBtn">Eliminar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- Configuración base para playlist_detail -->
<script>
// Obtener ID de playlist
function getPlaylistId() {
    // 1. Intentar desde el input hidden
    const hiddenInput = document.getElementById('playlist-id');
    if (hiddenInput && hiddenInput.value) {
        console.log('✅ [getPlaylistId] ID desde input hidden:', hiddenInput.value);
        return hiddenInput.value;
    }
    
    // 2. Intentar desde la URL
    const urlParams = new URLSearchParams(window.location.search);
    const urlId = urlParams.get('id');
    if (urlId) {
        console.log('✅ [getPlaylistId] ID de URL:', urlId);
        return urlId;
    }
    
    // 3. Intentar desde currentPlaylistData
    if (window.currentPlaylistData && window.currentPlaylistData.id) {
        console.log('✅ [getPlaylistId] ID desde datos actuales:', window.currentPlaylistData.id);
        return window.currentPlaylistData.id;
    }
    
    console.error('❌ [getPlaylistId] No se pudo obtener el ID de la playlist');
    return null;
}

/**
 * Cargar datos desde el template
 */
function loadDataFromTemplate() {
    try {
        const playlistElement = document.getElementById('playlist-data');
        if (playlistElement && playlistElement.textContent) {
            let jsonText = playlistElement.textContent.trim();
            
            // Corregir JSON malformado
            jsonText = jsonText
                .replace(/"([^"]+)":\s*,/g, '"$1": null,')
                .replace(/,\s*}/g, '}')
                .replace(/,\s*]/g, ']');
            
            const templateData = JSON.parse(jsonText);
            if (templateData && templateData.id) {
                window.currentPlaylistData = templateData;
                window.playlistVideos = templateData.videos || [];
                
                console.log('📋 Datos de playlist cargados desde template:', templateData.title);
            }
        }
    } catch (error) {
        console.warn('⚠️ Error cargando datos desde template:', error);
    }
}

// Cargar datos inmediatamente
loadDataFromTemplate();

console.log('✅ Configuración base de playlist_detail cargada');
</script>

<!-- Script principal de funcionalidad -->
<script src="/static/js/playlist_detail.js"></script>
<script src="/static/js/device-assignment-modal.js"></script>
<script src="/static/js/assigned-devices-manager.js"></script>
<!-- Script específico del template -->
<script>
/**
 * FUNCIONALIDAD ESPECÍFICA DEL TEMPLATE PLAYLIST_DETAIL
 */

// ==========================================
// INICIALIZACIÓN Y GESTIÓN DE DATOS
// ==========================================

/**
 * Cargar datos de playlist desde el template JSON embebido
 */
function loadPlaylistDataFromTemplate() {
    try {
        const playlistElement = document.getElementById('playlist-data');
        if (playlistElement && playlistElement.textContent) {
            try {
                // Intentar cargar el JSON
                const data = JSON.parse(playlistElement.textContent);
                
                // Solo asignar a variables globales si se cargó correctamente
                if (data && data.id) {
                    // Definir datos de playlist y videos
                    window.currentPlaylistData = data;
                    window.playlistVideos = data.videos || [];
                    
                    console.log('📋 Datos de playlist cargados desde template:', data.title);
                    
                    // Actualizar estadísticas
                    window.updatePlaylistStats();
                }
            } catch (error) {
                console.warn('⚠️ Error al parsear JSON del template:', error);
            }
        }
    } catch (error) {
        console.warn('⚠️ No se pudieron cargar datos desde template:', error);
    }
}

/**
 * Actualizar estadísticas de la playlist
 */
function updatePlaylistStats() {
    const videos = window.playlistVideos || [];
    
    // Calcular estadísticas
    const videoCount = videos.length;
    const totalDuration = videos.reduce((total, video) => total + (video.duration || 0), 0);
    
    // Actualizar UI
    const videoCountEl = document.getElementById('statVideoCount');
    const durationEl = document.getElementById('statTotalDuration');
    
    if (videoCountEl) {
        videoCountEl.textContent = videoCount;
    }
    
    if (durationEl) {
        // Formatear duración
        const hours = Math.floor(totalDuration / 3600);
        const minutes = Math.floor((totalDuration % 3600) / 60);
        
        if (hours > 0) {
            durationEl.textContent = `${hours}h ${minutes}m`;
        } else {
            durationEl.textContent = `${minutes}m ${Math.floor(totalDuration % 60)}s`;
        }
    }
}

/**
 * Formatear duración en segundos a formato mm:ss
 */
function formatDuration(seconds) {
    if (!seconds || isNaN(seconds)) return '00:00';
    
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

/**
 * Mostrar toast de notificación
 */
function showToast(message, type = 'info') {
    // Implementación básica (reemplazar con Bootstrap o similar)
    const toastContainer = document.getElementById('toastContainer') || document.createElement('div');
    if (!document.getElementById('toastContainer')) {
        toastContainer.id = 'toastContainer';
        toastContainer.style.position = 'fixed';
        toastContainer.style.top = '20px';
        toastContainer.style.right = '20px';
        toastContainer.style.zIndex = '9999';
        document.body.appendChild(toastContainer);
    }
    
    const toast = document.createElement('div');
    toast.className = `alert alert-${type}`;
    toast.innerHTML = message;
    toast.style.marginBottom = '10px';
    
    toastContainer.appendChild(toast);
    
    setTimeout(() => {
        toastContainer.removeChild(toast);
    }, 3000);
}

/**
 * Marcar cambios como no guardados
 */
function markAsUnsaved() {
    console.log('Cambios sin guardar detectados');
    
    // Habilitar botón de guardar
    const saveBtn = document.getElementById('savePlaylistBtn');
    if (saveBtn) {
        saveBtn.disabled = false;
    }
}

/**
 * Confirmar eliminación de playlist
 */
function confirmDeletePlaylist(playlistId) {
    // Mostrar modal de confirmación
    const modal = new bootstrap.Modal(document.getElementById('deletePlaylistModal'));
    modal.show();
    
    // Configurar botón de confirmación
    const confirmBtn = document.getElementById('confirmDeletePlaylistBtn');
    if (confirmBtn) {
        confirmBtn.onclick = function() {
            deletePlaylist(playlistId);
            modal.hide();
        };
    }
}

/**
 * Eliminar playlist
 */
function deletePlaylist(playlistId) {
    console.log('Eliminando playlist:', playlistId);
    
    // Implementar lógica de eliminación
    fetch(`/api/playlists/${playlistId}`, {
        method: 'DELETE'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Error al eliminar la playlist');
        }
        
        showToast('Lista de reproducción eliminada correctamente', 'success');
        
        // Redireccionar a la lista de playlists
        setTimeout(() => {
            window.location.href = '/ui/playlists';
        }, 1000);
    })
    .catch(error => {
        console.error('Error:', error);
        showToast(`Error: ${error.message}`, 'danger');
    });
}

/**
 * Alternar modo de edición
 */
function toggleEditMode() {
    const isEditMode = document.body.classList.toggle('edit-mode');
    
    // Cambiar texto del botón
    const editBtn = document.getElementById('toggleEditModeBtn');
    if (editBtn) {
        editBtn.innerHTML = isEditMode ? 
            '<i class="fas fa-eye me-2"></i>Modo Visualización' : 
            '<i class="fas fa-edit me-2"></i>Modo Edición';
    }
    
    // Habilitar/deshabilitar campos
    const inputs = document.querySelectorAll('.playlist-form-control');
    inputs.forEach(input => {
        input.disabled = !isEditMode;
    });
    
    // Mostrar/ocultar botones de acción
    const actionBtns = document.querySelectorAll('.edit-action');
    actionBtns.forEach(btn => {
        btn.style.display = isEditMode ? 'inline-flex' : 'none';
    });
}

/**
 * Exportar playlist a JSON
 */
function exportPlaylist(playlistId) {
    console.log('Exportando playlist:', playlistId);
    
    // Crear archivo para descargar
    const data = JSON.stringify(window.currentPlaylistData, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    // Crear link de descarga
    const a = document.createElement('a');
    a.href = url;
    a.download = `playlist_${playlistId}.json`;
    document.body.appendChild(a);
    a.click();
    
    // Limpiar
    setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }, 0);
    
    showToast('Playlist exportada correctamente', 'success');
}

/**
 * Aleatorizar orden de videos
 */
function shufflePlaylist() {
    console.log('Aleatorizando orden de videos');
    
    if (!window.playlistVideos || window.playlistVideos.length < 2) {
        showToast('No hay suficientes videos para aleatorizar', 'warning');
        return;
    }
    
    // Confirmar acción
    if (!confirm('¿Estás seguro de aleatorizar el orden de los videos?')) {
        return;
    }
    
    // Hacer copia y mezclar
    const videos = [...window.playlistVideos];
    
    // Algoritmo Fisher-Yates para mezclar
    for (let i = videos.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [videos[i], videos[j]] = [videos[j], videos[i]];
    }
    
    // Actualizar posiciones
    videos.forEach((video, index) => {
        video.position = index;
    });
    
    // Actualizar datos
    window.playlistVideos = videos;
    
    // Implementar guardado de nuevo orden
    
    showToast('Orden de videos aleatorizado', 'success');
}

/**
 * Formatear fecha para input type="date"
 */
function formatDateForInput(date) {
    if (!date || !(date instanceof Date) || isNaN(date)) return '';
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

// Hacer funciones disponibles globalmente
window.updatePlaylistStats = updatePlaylistStats;
window.formatDuration = formatDuration;
window.showToast = showToast;
window.markAsUnsaved = markAsUnsaved;
window.confirmDeletePlaylist = confirmDeletePlaylist;
window.deletePlaylist = deletePlaylist;
window.toggleEditMode = toggleEditMode;
window.exportPlaylist = exportPlaylist;
window.shufflePlaylist = shufflePlaylist;
window.formatDateForInput = formatDateForInput;

// Inicializar datos cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    loadPlaylistDataFromTemplate();
});

console.log('✅ Script específico del template cargado');
</script>
{% endblock %}